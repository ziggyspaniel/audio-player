<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Audio</title>
<style>
  :root { --z: 1; }                              /* scale factor (overrides via ?z=1.2) */
  html,body{margin:0;padding:0;background:transparent;font:14px/1.2 system-ui;overflow-x:hidden}
  .wrap{padding:6px 8px}
  .title{display:none;margin:0 0 6px;color:#111;font-weight:600;font-size:13px}
  .fallback{display:none;color:#900;margin:6px 0 0}
  audio{
    width:calc(100% / var(--z));                 /* shrink width then scale up for compact controls */
    transform:scale(var(--z));
    transform-origin:left center;
  }
  @media (max-width:480px){
    .wrap{max-width:340px;margin:10px auto}
    :root{ --z:1.2 }                             /* slightly larger controls on very small widths */
  }
</style>

<body>
  <div class="wrap">
    <div id="title" class="title"></div>
    <audio id="player" preload="metadata" controls controlslist="nodownload"></audio>
    <div id="fallback" class="fallback">No audio link provided.</div>
  </div>

<script>
  // --- query params ---
  const qs    = new URLSearchParams(location.search);
  const src   = qs.get('src');                   // required
  const title = qs.get('title');                 // optional
  const zoom  = parseFloat(qs.get('z') || '') || null;
  const autoplay = (qs.get('autoplay') ?? '1') !== '0'; // default ON

  if (zoom && zoom > 0.6 && zoom <= 1.8) {
    document.documentElement.style.setProperty('--z', zoom);
  }

  const audio = document.getElementById('player');
  const fb    = document.getElementById('fallback');

  // optional title
  if (title) {
    const t = document.getElementById('title');
    t.textContent = decodeURIComponent(title);
    t.style.display = 'block';
  }

  // tell parent our size (Wix reveals iframe when ready)
  function sendSize() {
    const h = document.documentElement.scrollHeight || document.body.scrollHeight || 80;
    parent.postMessage(JSON.stringify({ type: 'audioplayer:size', h }), '*');
  }
  function ready() {
    parent.postMessage(JSON.stringify({ type: 'audioplayer:ready' }), '*');
    sendSize();
  }
  window.addEventListener('load', sendSize);
  new ResizeObserver(sendSize).observe(document.body);

  // set src + autoplay
  if (src && src.trim()) {
    audio.src = src.trim();
    fb.style.display = 'none';
    if (autoplay) {
      // try unmuted; if blocked, fallback to muted autoplay
      audio.play().catch(() => { audio.muted = true; audio.play().catch(()=>{}); });
    }
  } else {
    fb.style.display = 'block';
  }

  // update size when metadata known or volume toggled
  audio.addEventListener('loadedmetadata', sendSize);
  audio.addEventListener('volumechange', sendSize);

  // signal parent that weâ€™re good
  ready();
</script>
</body>
</html>
